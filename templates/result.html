{% extends "base.html" %}

{% block title %}Résultat - ProofOrigin{% endblock %}

{% block content %}
<div style="display: flex; align-items: center; margin-bottom: 2rem;">
    <a href="/" class="btn btn-secondary" style="margin-right: 1rem;">
        <i class="fas fa-arrow-left"></i>
        Retour
    </a>
    <div>
        <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">
            <i class="fas fa-check-circle" style="color: var(--success-color); margin-right: 0.5rem;"></i>
            Résultat de l'opération
        </h1>
        <p style="color: var(--text-secondary);">
            Détails de la preuve d'authenticité
        </p>
    </div>
</div>

<div class="card">
    <div class="card-body">
        {% if "✅" in message %}
        <!-- Success State -->
        <div class="alert alert-success">
            <i class="fas fa-check-circle"></i>
            <div>
                <strong>Opération réussie !</strong>
                <div style="margin-top: 0.5rem;">{{ message|safe|replace("✅", "")|replace("<br>", "<br>") }}</div>
            </div>
        </div>
        
        {% if "registered" in message.lower() %}
        <!-- Registration Success -->
        <div style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem; font-weight: 600;">
                <i class="fas fa-shield-alt" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                Preuve d'authenticité créée
            </h3>
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Détails du fichier</h4>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 1rem;">
                            <strong>Nom du fichier :</strong>
                            <div style="color: var(--text-secondary); margin-top: 0.25rem;">
                                {{ message.split("'")[1] if "'" in message else "N/A" }}
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Empreinte SHA-256 :</strong>
                            <div style="margin-top: 0.25rem;">
                                <code style="background: var(--background-color); padding: 0.5rem; border-radius: var(--radius-sm); font-size: 0.875rem; word-break: break-all; display: block;">
                                    {{ message.split("Hash: ")[1].split("<br>")[0] if "Hash: " in message else "N/A" }}
                                </code>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Signature cryptographique</h4>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 1rem;">
                            <strong>Algorithme :</strong>
                            <span class="badge badge-success">RSA-2048 + PSS</span>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Signature :</strong>
                            <div style="margin-top: 0.25rem;">
                                <code style="background: var(--background-color); padding: 0.5rem; border-radius: var(--radius-sm); font-size: 0.75rem; word-break: break-all; display: block;">
                                    {{ message.split("Signature: ")[1].split("...")[0] if "Signature: " in message else "N/A" }}...
                                </code>
                            </div>
                        </div>
                        <div>
                            <strong>Horodatage :</strong>
                            <div style="color: var(--text-secondary); margin-top: 0.25rem;">
                                {{ time.strftime('%Y-%m-%d %H:%M:%S', time.localtime()) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        {% elif "verified" in message.lower() %}
        <!-- Verification Success -->
        <div style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem; font-weight: 600;">
                <i class="fas fa-search" style="color: var(--success-color); margin-right: 0.5rem;"></i>
                Fichier vérifié avec succès
            </h3>
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Informations de vérification</h4>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 1rem;">
                            <strong>Statut :</strong>
                            <span class="badge badge-success">Authentique</span>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Fichier :</strong>
                            <div style="color: var(--text-secondary); margin-top: 0.25rem;">
                                {{ message.split("File: ")[1].split("<br>")[0] if "File: " in message else "N/A" }}
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Empreinte :</strong>
                            <div style="margin-top: 0.25rem;">
                                <code style="background: var(--background-color); padding: 0.5rem; border-radius: var(--radius-sm); font-size: 0.875rem; word-break: break-all; display: block;">
                                    {{ message.split("Hash: ")[1].split("...")[0] if "Hash: " in message else "N/A" }}...
                                </code>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Détails d'enregistrement</h4>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 1rem;">
                            <strong>Date d'enregistrement :</strong>
                            <div style="color: var(--text-secondary); margin-top: 0.25rem;">
                                {{ message.split("Timestamp: ")[1] if "Timestamp: " in message else "N/A" }}
                            </div>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>Intégrité :</strong>
                            <span class="badge badge-success">Vérifiée</span>
                        </div>
                        <div>
                            <strong>Authenticité :</strong>
                            <span class="badge badge-success">Confirmée</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        {% elif "⚠️" in message %}
        <!-- Warning State -->
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
                <strong>Attention</strong>
                <div style="margin-top: 0.5rem;">{{ message|safe|replace("⚠️", "")|replace("<br>", "<br>") }}</div>
            </div>
        </div>
        
        <div style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem; font-weight: 600;">
                <i class="fas fa-info-circle" style="color: var(--warning-color); margin-right: 0.5rem;"></i>
                Fichier déjà enregistré
            </h3>
            <div class="card">
                <div class="card-body">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Ce fichier existe déjà dans notre registre. Cela signifie qu'il a été précédemment enregistré et qu'une preuve d'authenticité existe déjà.
                    </p>
                    <div style="margin-bottom: 1rem;">
                        <strong>Empreinte existante :</strong>
                        <div style="margin-top: 0.25rem;">
                            <code style="background: var(--background-color); padding: 0.5rem; border-radius: var(--radius-sm); font-size: 0.875rem; word-break: break-all; display: block;">
                                {{ message.split("Hash: ")[1].split("...")[0] if "Hash: " in message else "N/A" }}...
                            </code>
                        </div>
                    </div>
                    <a href="/list" class="btn btn-secondary">
                        <i class="fas fa-list"></i>
                        Voir le registre
                    </a>
                </div>
            </div>
        </div>
        
        {% elif "❌" in message %}
        <!-- Error State -->
        <div class="alert alert-error">
            <i class="fas fa-times-circle"></i>
            <div>
                <strong>Fichier non trouvé</strong>
                <div style="margin-top: 0.5rem;">{{ message|safe|replace("❌", "")|replace("<br>", "<br>") }}</div>
            </div>
        </div>
        
        <div style="margin-top: 2rem;">
            <h3 style="margin-bottom: 1rem; font-weight: 600;">
                <i class="fas fa-search" style="color: var(--error-color); margin-right: 0.5rem;"></i>
                Fichier non authentifié
            </h3>
            <div class="card">
                <div class="card-body">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Ce fichier n'a pas été trouvé dans notre registre. Cela peut signifier qu'il n'a jamais été enregistré ou qu'il a été modifié depuis son enregistrement.
                    </p>
                    <div style="margin-bottom: 1rem;">
                        <strong>Empreinte calculée :</strong>
                        <div style="margin-top: 0.25rem;">
                            <code style="background: var(--background-color); padding: 0.5rem; border-radius: var(--radius-sm); font-size: 0.875rem; word-break: break-all; display: block;">
                                {{ message.split("Hash: ")[1].split("...")[0] if "Hash: " in message else "N/A" }}...
                            </code>
                        </div>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <a href="/" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Enregistrer ce fichier
                        </a>
                        <a href="/list" class="btn btn-secondary">
                            <i class="fas fa-list"></i>
                            Voir le registre
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div style="margin-top: 2rem; text-align: center;">
    <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
        <a href="/" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Enregistrer un autre fichier
        </a>
        <a href="/verify" class="btn btn-success">
            <i class="fas fa-search"></i>
            Vérifier un autre fichier
        </a>
        <a href="/list" class="btn btn-secondary">
            <i class="fas fa-list"></i>
            Voir le registre
        </a>
    </div>
</div>
{% endblock %}
